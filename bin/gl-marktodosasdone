#!/bin/bash

export PATH=:/usr/local/bin:$PATH

source ~/.localrc;

> /tmp/gitlab-todos-closed.txt;

cat /tmp/gitlab-todos.json | jq -rc '.[] | select(.target.state == "closed") | .id' > /tmp/gitlab-todos-closed.txt;

while read i; do
  curl --request POST --header "PRIVATE-TOKEN: $GLPRIVATETOKEN" https://gitlab.com/api/v4/todos/$i/mark_as_done
done </tmp/gitlab-todos-closed.txt;

say "todos are marked as done"